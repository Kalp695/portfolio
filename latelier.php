<?phprequire_once("inc/init_inc.php");include_once('geshi.php');?><title>Michaël GOMES - L'atelier</title><meta name="description" content="Développeur web PHP, JavaScript, Intégrateur HTML5, XHTML, CSS3, Architecture client serveur SQL, mySQL, XML"><?phpinclude('inc/head_inc.php');?><div id='wip'></div><div id="blank">    <div id="blankleft">        <div id="titrepage">            <p>L'Atelier</p>        </div>    </div>    <div id="blankright">        <div id="blanknav">            <p><a href="portfolio.php">PORTFOLIO</a> / <a href="blog.php?page=1">BLOG</a></p>        </div>        <div class="clear"></div>    </div><!-- fin #blankright --></div><!-- fin #blank --><?phpecho $msg;?><!-- start div id="content" --><div id="content">    <section id="sectionAtelier">        <?php        /* START affichage des articles */        if (isset($_GET['article']) && !empty($_GET['article'])) {            // ---- PROGRESS BAR            if ($_GET[article] === 'progressBar') {                ?>                <script src="JS/atelier.js"></script>                <article id="articleAtelier">                    <div class="contenuArticleAtelier">                        <p class='titreArticleAtelier'>Progress Bar</p>                        <div class="progressbarBackground">                            <div id="progressbar1"><p id="text1">Une Progress bar...</p></div>                        </div>                        <div class="progressbarBackground">                            <div id="progressbar2"><p id="text2">avec du texte dedans !</p></div>                        </div>                        <div class="progressbarBackground">                            <div id="progressbar3"><p id="text3"> ( ͡ᵔ ͜ʖ ͡ᵔ ) </p></div>                        </div>                        <p class='textArticleAtelier'>HTML:</p>                        <article class='codeAtelier'>                            <?php                            $sourceHTML1 = '<div class="progressbarBackground">    <div id="progressbar1"><p id="text1">Une Progress bar...</p></div></div><div class="progressbarBackground">    <div id="progressbar2"><p id="text2">avec du texte dedans !</p></div></div><div class="progressbarBackground">    <div id="progressbar3"><p id="text3"> ( ͡ᵔ ͜ʖ ͡ᵔ ) </p></div></div>';                            $languageHTML1 = 'html5';                            $geshiHTML1 = new GeSHi($sourceHTML1, $languageHTML1);                            echo $geshiHTML1->parse_code();                            ?>                        </article>        <p class='textArticleAtelier'>CSS:</p>        <article class='codeAtelier'>            <?php            $sourceCSS1 = ".progressbarBackground{    margin:20px 0 0 50px;        padding:0;        background:#F1F1F1;        width:310px;        height:30px;        line-height:30px;}.progressbarBackground p{        margin:0 0 0 20px;        padding:0;            font-family:arial, sans serif;        font-size:12px;        color:#4C4C4C;    display:none;}#progressbar1{        margin:0;        padding:0;        background:#B6D82F;     width:0;    height:30px;}#progressbar2{        margin:0;        padding:0;        background:#B1B1B1;     width:0;    height:30px;}#progressbar3{        margin:0;        padding:0;        background:#B6D82F;     width:0;    height:30px;}";            $languageCSS1 = 'css';            $geshiCSS1 = new GeSHi($sourceCSS1, $languageCSS1);            echo $geshiCSS1->parse_code();            ?>        </article>        <p class='textArticleAtelier'>JavaScript:</p>        <article class='codeAtelier'>            <?php            $sourceJS1 = 'window.onload = function() {    var execute = function(div, PX, text) {        var rempli = function() {            var laDiv = window.document.getElementById(div);            if (PX > parseInt(laDiv.offsetWidth, 10)) {                laDiv.style.width = parseFloat(laDiv.offsetWidth) + 1 + "px";            }            else {                window.document.getElementById(text).style.display = "inline";                clearInterval(timing);            }        };        var timing = setInterval(function() {            rempli();        }, 1);    };    var tableauDonnees = new Array();    tableauDonnees = [        ["progressbar1", 150, "text1"],        ["progressbar2", 250, "text2"],        ["progressbar3", 300, "text3"]    ];    for (var i = 0; i < tableauDonnees.length; i++) {        execute(tableauDonnees[i][0], tableauDonnees[i][1], tableauDonnees[i][2]);    };}; /* END OF window.onload */';            $languageJS1 = 'javascript';            $geshiJS1 = new GeSHi($sourceJS1, $languageJS1);            echo $geshiJS1->parse_code();            ?>        </article>        <p class='textArticleAtelier'>Hope it helps !</p>        </div>        <div class="clear"></div>        </article>        <?php    }    // ---- SESSION UTILISATEUR    if ($_GET[article] === 'session') {        ?>        <article id="articleAtelier">            <div class="contenuArticleAtelier">                <p class='titreArticleAtelier'>Créer une session utilisateur</p>                <p class='textArticleAtelier'>Je partage ici mon expérience sur la création d'un espace membre, basé sur l'utilisation des sessions. Le code présenté ici est quasi similaire à celui utilisé pour créer les sessions utilisateur du site <a href='http://www.lokisalle.diw.fr' target='_blank'>lokisalle.diw.fr</a>. Pour toute suggestions ou correction n'hésitez pas à me contacter.</p>                <p class='textArticleAtelier'>Nous partirons du principe que le site comporte 6 pages: le <span class="black">formulaire de connexion</span>, le <span class="black">formulaire d'inscription</span>, une <span class="black">page profil</span> (ou page membre), une <span class="black">page de déconnexion</span> et enfin une page d'acceuil (index.php - non détaillée dans ce "how to").</p>                <p class='textArticleAtelier'>De plus, les informations nécessaire à la connexion d'un membre seront son pseudo (ou login), ainsi que son adresse e-mail.</p>                <p class='textArticleAtelier'>Enfin, une table SQL que l'on nommera "membre" contenant un champ ID_MEMBRE (type int(5), AUTO_INCREMENT), un champ pseudo (VARCHAR(15)) et un champ mdp (type text) sera nécessaire. Bien sûr, nous pourrions ajouter les champs nom, prénom, adresse, date..., mais ce ne sera pas utile pour la démonstration.</p>                <p class='textArticleAtelier'>Pour créer votre base de donnée, je vous invite à consulter <a href="http://dev.mysql.com/doc/refman/5.0/fr/database-use.html" target="_blank">la documentation MySQL sur le sujet</a>.</p>                <p class='textArticleAtelier'>Avant tout, commencons par créer un document que l'on nommera "connexion_bdd_inc.php". Ce document sera à inclure sur toutes les pages nécessitant une connexion à la base de donnée, via l'instruction <a href='http://www.php.net/manual/fr/function.require-once.php' target='_blank'>require_once</a> de PHP.</p>                <?php                $sourceIncConnexion = '// Connexion à la base de donnée.$baseDeDonnee = @new Mysqli(\'le_Nom_Du_Serveur\', \'Votre_Pseudo\', \'Votre_Mot_De_Passe\', "le_Nom_de_la_bdd");header(\'Content-Type: text/html; charset=utf-8\');$mysqli->set_charset (\'utf8\');if($mysqli->connect_error){    die("Un probmème est survenu lors de la tentative de connexion à la BDD : " . $mysqli->connect_error);}';                $languageIncConnexion = 'php';                $geshiIncConnexion = new GeSHi($sourceIncConnexion, $languageIncConnexion);                echo $geshiIncConnexion->parse_code();                ?>                <p class='titreAA'>Le formulaire d'inscription</p>                <p class='textArticleAtelier'>Avec la page d'inscription, le membre pourra saisir les informations à enregistrer en base de donnée.</p>                <p class='textArticleAtelier'>Nous y créerons un formulaire avec trois champs: un champ <span class="black">Pseudo</span>, un champ <span class="black">mot de passe</span> et un champ de <span class="black">confirmation du mot de passe.</span></p>                <p class='textArticleAtelier'>Le mot de passe sera bien sûr crypté, ou plutôt "hashé" grâce à la fonction <a href="http://www.php.net/manual/fr/function.md5.php" target="_blank">md5 de php</a>.</p>                <p class='textArticleAtelier'>Une fois qu'il est établi que le formulaire est bien complété, nous devrons vérifier si les deux mots de passe correspondent.</p>                <p class='textArticleAtelier'>Puis, nous vérifierons si le pseudo de l'utilisateur existe déjà en base de donnée.</p>                <p class='textArticleAtelier'>Enfin, lorsque tous cela est fait, il ne restera plus qu'à valider l'inscription en envoyant toutes ces informations dans notre base de donnée.</p>                <p class='textArticleAtelier'>L'utilisateur sera alors redirigé vers sa page profil.</p>                <p class='textArticleAtelier'>Voici le code PHP à insérer en haut de la page <span class="black">inscription.php</span>:</p>                <?php                $source = '<?php// Nous incluons la connexion à la base de donnéesrequire_once("connexion_bdd_inc.php");// Nous vérifions si l\'internaute à validé le formulaireif (isset($_POST[\'inscription\']) && $_POST[\'inscription\'] == \'Inscription\') {    // Nous vérifions si les champs input ont une valeur    if ((isset($_POST[\'pseudo\']) && !empty($_POST[\'pseudo\'])) && (isset($_POST[\'mdp\']) && !empty($_POST[\'mdp\'])) && (isset($_POST[\'Confirm_mdp\']) && !empty($_POST[\'Confirm_mdp\']))) {        // Nous vérifions si le mot de passe et sa confirmation sont strictement identique        if ($_POST[\'mdp\'] != $_POST[\'Confirm_mdp\']) {            $msg = \'Les 2 mots de passe sont différents.\';        } else {            // Nous vérifions qu\'il n\'y ai pas de caractères spéciaux            $verif_caractere = preg_match("/^(\w|-|\'|é|è|ê|ç|à|â|ä|ù|ü|î|ï|ô|ö)*$/", stripslashes($_POST[\'pseudo\']));            $verif_caractere2 = preg_match("/^(\w|-|\'|é|è|ê|ç|à|â|ä|ù|ü|î|ï|ô|ö)*$/", stripslashes($_POST[\'mdp\']));            if(!$verif_caractere || !$verif_caractere2){                $msg = \'Certains caractères ne sont pas acceptés\';            }            if (empty($msg)) {                // Nous vérifions si le pseudo est déjà utilisé                $sql = \'SELECT count(*) \'                    .\'FROM membre \'                    .\'WHERE pseudo="\'.($_POST[\'pseudo\']).\'"\';                $requete = mysqli_query($sql) or die(\'Erreur SQL !<br />\'.$sql.\'<br />\'.mysql_error());                                if ($requete->num_rows == 0) {                    $msg = \'Ce pseudo existe déjà\';                }else{                    $sql = \'INSERT INTO membre \'                        .\'VALUES("", "\'.($_POST[\'pseudo\']).\'", "\'.md5($_POST[\'mdp\']).\'")\';                    mysqli_query($sql) or die(\'Erreur SQL !\'.$sql.\'<br />\'.mysql_error());                    session_start();                    $_SESSION[\'pseudo\'] = $_POST[\'pseudo\'];                    header(\'Location: profil.php\');                    exit();                }             }        }    } else {        $msg = \'Au moins un des champs est vide.\';    }}?>';$source2 ='<html><head>    <title>Page d\'inscription</title></head><body>    <p>Vos informations :</p>    <form method="post" action="inscription.php">        <label for="pseudo">Pseudo :</label>        <input type="text" name="pseudo" value="<?php if (isset($_POST[\'pseudo\'])) echo htmlentities(trim($_POST[\'pseudo\'])); ?>"/>        <label for="mdp">Mot de passe :</label>        <input type="password" name="mdp" value="<?php if (isset($_POST[\'mdp\'])) echo htmlentities(trim($_POST[\'mdp\'])); ?>"/>        <label for="Confirm_mdp">Confirmation du mot de passe :</label>        <input type="password" name="Confirm_mdp" value="<?php if (isset($_POST[\'Confirm_mdp\'])) echo htmlentities(trim($_POST[\'Confirm_mdp\'])); ?>"/>        <input type="submit" name="inscription" value="Valider"/>    </form>    <?php    if (isset($msg)) echo $msg;    ?></body></html>';                $language = 'php';                $geshi = new GeSHi($source, $language);                $geshibis = new GeSHi($source2, $language);                echo $geshi->parse_code();                ?>                <p class='textArticleAtelier'>Le code HTML:</p>                <?php                echo $geshibis->parse_code();                ?>                <p class='textArticleAtelier'><a href='http://us3.php.net/manual/fr/function.htmlentities.php' target='_blank'>*htmlentities</a>: Convertit tous les caractères éligibles en entités HTML.<br/>                <a href='http://us3.php.net/manual/fr/function.trim.php' target='_blank'>*trim</a>: Supprime les espaces (ou d'autres caractères) en début et fin de chaîne.</p>                <p class='titreAA'>Le formulaire de connexion</p>                <p class='textArticleAtelier'>Le membre, grâce à son pseudo et à son mot de passe pourra se connecter à son espace membre via cette page.</p>                <p class='textArticleAtelier'>Lorsque l'utilisateur valide son formulaire, celui-ci sera testé pour vérifier si les champs sont bien remplis. Si ce n'est pas le cas, nous devons en informer l'utilisateur.</p>                <p class='textArticleAtelier'>Si le formulaire est bien remplie, l'étape suivante consiste à interroger la base de donnée par une requête SQL. En somme, nous demandons à la base de donnée si les informations saisies existent dans la base de donnée, et si le pseudoest associé au bon mot de passe.</p>                <p class='textArticleAtelier'>Le mot de passe ayant été enregistré de façon "hashé" dans la base de donnée, il ne sera pas possible de rechercher le mot de passe tel que saisi par l'utilisateur. Il faudra donc utiliser de nouveau la fonction md5.</p>                <p class='textArticleAtelier'>Pour finir, si le pseudo existe et que l'association avec le mot de passe est la bonne, nous pourrons démarrer une session et rediriger l'utilisateur vers sa page profil. A l'inverse, nous restons sur le formulaire de connexion en indiquant l'erreur à l'utilisateur.</p>                <p class='textArticleAtelier'>Voilà pour la partie PHP de la page <span class="black">connexion.php</span>:</p>                <?php                $sourceConnectPHP = '<?php// Nous incluons la connexion à la base de donnéesrequire_once("connexion_bdd_inc.php");                    // Nous vérifions si l\'internaute a validé le formulaire de connexion, et que tous les champs sont complétésif (isset($_POST[\'connexion\']) && $_POST[\'connexion\'] == \'Connexion\') {    if ((isset($_POST[\'pseudo\']) && !empty($_POST[\'pseudo\'])) && (isset($_POST[\'mdp\']) && !empty($_POST[\'mdp\']))) {        // on teste si le pseudo saisie est bien associé au mot de passe saisie dans la base de donnée.        $sql = "SELECT count(*) "            ."FROM membre "            ."WHERE login=\'".$_POST[\'pseudo\']."\' "            .\'AND mdp="\'.md5($_POST[\'mdp\']).\'"\';        $requete = mysqli_query($sql) or die(\'Erreur SQL !<br />\'.$sql.\'<br />\'.mysql_error());        if($requete->num_rows == 0){            $msg = "Veuillez vérifier vos identifiants de connexion";        }else{            // si il y a au moins un résultat, l\'utilisateur existe            session_start();            $_SESSION[\'pseudo\'] = $_POST[\'pseudo\'];            header(\'Location: profil.php\');            exit();        }    }else{        $msg = "Tous les champs sont obligatoire.";    }}?>';                $sourceConnectHTML = '<html><head>    <title>Page de connexion</title></head><body>    <p>Connexion à l\'espace membre :</p>    <form action="" method="post">        <label for="pseuo">Pseudo :</label>        <input type="text" name="pseudo" value="<?php if (isset($_POST[\'pseudo\'])) echo htmlentities(trim($_POST[\'pseudo\'])); ?>">        <label for="mdp">Mot de passe :</label>        <input type="password" name="mdp" value="<?php if (isset($_POST[\'mdp\'])) echo htmlentities(trim($_POST[\'mdp\'])); ?>">        <input type="submit" name="connexion" value="Se connecter">    </form>    <a href="inscription.php">Pas encore membre? S\'inscrire ici !</a>    <?php        if (isset($msg)) echo $msg;    ?></body></html>';                $geshiConnectPHP = new GeSHi($sourceConnectPHP, $language);                $geshiConnectHTML = new GeSHi($sourceConnectHTML, $language);                echo $geshiConnectPHP->parse_code();                ?>                <p class='textArticleAtelier'>Le HTML:</p>                <?php                echo $geshiConnectHTML->parse_code();                ?>                <p class='titreAA'>La page profil</p>                <p class='textArticleAtelier'>Par le formulaire de connexion, il a été établie l'existence du membre. Néanmoins, une dernière vérification reste à faire sur la page membre, et plus largement sur toutes les pages où le membre doit être identifié.</p>                <p class='textArticleAtelier'>En effet, il faut s'assurer que l'utilisateur qui accède à cette page s'est bien identifié au préalable, et qu'il n'a pas saisi directement l'url de la page par exemple.</p>                <p class='textArticleAtelier'>Il faut alors tester la variable $_SESSION['pseudo']. Si elle existe, l'utilisateur est connecté, et la page s'affichera.</p>                <p class='textArticleAtelier'>Si elle n'existe pas, il faudra rediriger l'utilisateur vers une autre page du site, la page de connexion par exemple.</p>                <p class='textArticleAtelier'>PHP de la page <span class="black">profil.php</span>:</p>                <?php                $sourceProfil = '<?phpsession_start();if (!isset($_SESSION[\'pseudo\'])) {    header (\'Location: connexion.php\');    exit();}else{    $membre = htmlentities(trim($_SESSION[\'pseudo\']);}?>';                $sourceProfilHTML = '<html><head>    <title>Votre Profil</title></head><body>    <p>Bienvenue <?php echo $membre; ?> !<br />    <a href="deconnexion.php">Se déconnecter</a></body></html>';                $languageProfil = 'php';                $languageProfilHTML = 'html5';                $geshiProfil = new GeSHi($sourceProfil, $languageProfil);                $geshiProfilHTML = new GeSHi($sourceProfilHTML, $languageProfilHTML);                echo $geshiProfil->parse_code();                ?>                <p class='textArticleAtelier'>Pour la partie HTML:</p>                <?php                echo $geshiProfilHTML->parse_code();                ?>                <p class='titreAA'>La page déconnexion</p>                <p class='textArticleAtelier'>Pour finir, nous allons créer une page <span class='black'>deconnexion.php</span> qui mettra fin à la session:</p>                <?php                $sourceDec = '<?php    session_start();    session_unset();    session_destroy();    header(\'Location: index.php\');    exit();    ?>';                $geshiDec = new GeSHi($sourceDec, $language);                echo $geshiDec->parse_code();                ?>                <p class='textArticleAtelier'>Cela reste bien sûr très épuré, et il y a encore pas mal de travail pour améliorer le site. On pourrait par exemple envoyer un e-mail de confirmation de création de compte avec le pseudo et un autre rappelant le mot de passe, créer une fonction pour les requête SQL plutôt que de les resaisir à chaque fois,...  </p>                <p class='textArticleAtelier'>Hope it helps !</p>            </div>            <div class="clear"></div>        </article>        <?php    }    // ---- COVER    if ($_GET[article] === 'cover') {        ?>        <article id="articleAtelier">            <div class="contenuArticleAtelier">                <p class='titreArticleAtelier'>Effet de couverture d'un élément par un autre au survol de la souris (onmouseenter & onmouseleave)</p>                <script src="JS/cover.js"></script>                <div id='containerExample'>                    <div class="site" onmouseover="couverture('cover')" onmouseout="decouvre('cover')">                        <img src="images/barca.jpg" alt="image"/>                        <div id="cover"><p>Partie de dames sous le soleil de Barcelone - Mars 2012</p></div>                    </div>                </div>                <!-- <p class='textArticleAtelier'>Pour réaliser cet effet, il faudra utiliser les attributs "onmouseenter" & "onmouseleave" plutôt que "onmouseover" & "onmouseout".<br/>                Les deux derniers attributs cités déclenchent l'évènement au survol de l'élément concerné. Ainsi, lorsque le second élément passera par dessus le premier, il arrêtera sa progression arrivé au niveau de la souris.<br/>                "Onmouseenter" & "onmouseleave" déclenchent l'évènement lorsque le pointeur survol l'élément concerné, mais aussi lors du survol des éléments enfants.</p> -->                <p class='textArticleAtelier'>Le code HTML est trés simple, il s'agit d'une div dans laquelle se trouve la seconde div:</p>                <?php                $sourceCover = '<div class="site" onmouseover="couverture(\'cover\')" onmouseout="decouvre(\'cover\')">    <img src="images/barca.jpg" alt="image"/>    <div id="cover"><p>Partie de dames sous le soleil de Barcelone - Mars 2012</p></div></div>';                                $languageCover = 'html5';                $geshiCover = new GeSHi($sourceCover, $languageCover);                echo $geshiCover->parse_code();                ?>                <p class='textArticleAtelier'>Voici le code JavaScrpt, lui aussi très simple, permettant de créer cet effet:</p>                <?php                $sourceCover2 = '<var couverture = function(x) {    var coverTop = window.document.getElementById(x);    coverTop.style.top = -120 + \'px\';};var decouvre = function(x) {    var coverTop = window.document.getElementById(x);    coverTop.style.top = 0 + \'px\';};';                                $languageCover2 = 'javascript';                $geshiCover2 = new GeSHi($sourceCover2, $languageCover2);                echo $geshiCover2->parse_code();                ?>                <p class='textArticleAtelier'>Et enfin, le code CSS permettant d'avoir cet effet assez fluide de montée et descente de la div au passage de la souris grâce à la propriété CSS transition:</p>                <?php                $sourceCover3 = '.site{    margin:40px 0 0 16px;    width:220px;    height: 150px;    padding:0;    box-shadow: 0 0 1px #333333;    overflow: hidden;}#cover{    width:220px;    height: 150px;    margin:0;padding:0;    background:#B6D82F;    display: table;    opacity: 0.90;    position: relative;    top: 0;    transition: top 400ms ease-in-out 0s;}';                                $languageCover3 = 'CSS';                $geshiCover3 = new GeSHi($sourceCover3, $languageCover3);                echo $geshiCover3->parse_code();                ?>                <p class='textArticleAtelier'>Hope it helps !</p>            </div>            <div class="clear"></div>        </article>        <?php    }    // ---- PENCHER DIV    if ($_GET[article] === 'pencherDiv') {        ?>        <article id="articleAtelier">            <div class="contenuArticleAtelier">                <p class='titreArticleAtelier'>Pencher une div</p>                <p class='textArticleAtelier'>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>                <p class='textArticleAtelier'>Hope it helps !</p>            </div>            <div class="clear"></div>        </article>        <?php    }} else {    ?>    <article id="articleAtelier">        <div class="contenuArticleAtelier">            <p class='titreArticleAtelier'>Qu'est ce que l'Atelier?</p>            <p class='textArticleAtelier'>Vous trouverez dans l'Atelier quelques codes développés sur les divers sites que j'ai créés, projets en cours... que ce soit en PHP, JavaScript, HTML/CSS...</p>                <p class='textArticleAtelier'>Utilisez le menu de droite pour afficher le code qui vous intéresse.</p>                <p class='textArticleAtelier'>Hope it helps !! :)</p>        </div>        <div class="clear"></div>    </article>    <img src='images/atelier.jpg' alt='Man thinking' />    <?php}?></section><!-- || SOMMAIRE || --><aside id="asideAtelier">    <div class='titreAtelierAside'>        <p>Publié récemment</p>    </div>    <div class='contenuAtelierAside'>        <ul id='ulAtelier'>            <li class="sansDisc">JavaScript            <ul>                <li><a href='latelier.php?article=progressBar'>Créer simplement une barre de progression</a></li>            </ul></li>            <li class="sansDisc">PHP            <ul>                <li><a href='latelier.php?article=session'>Créer une session utilisateur</a></li>            </ul></li>            <li class="sansDisc">CSS/JavaScript            <ul>                <li><a href='latelier.php?article=cover'>Effet de couverture d'un élément par un autre au survol</a></li>            </ul></li>                        <!-- <li>CSS</li>                 <a href='latelier.php?article=pencherDiv'>Pencher une div</a>-->        </ul>    </div></aside></div><!-- stop div id="content" --><!-- start footer --><?phpinclude("inc/footer_inc.php");?><!-- stop footer --></body></html>